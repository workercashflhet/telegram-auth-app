<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wheel of Fortune</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- –ê–Ω–∏–º–∞—Ü–∏—è —Å–Ω–µ–≥–∞ -->
    <div id="snowContainer" class="snow-container">
    <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É -->
    <!-- –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤–º–µ—Å—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ compactProfile -->
    <div id="compactProfile" class="compact-profile" role="region" aria-label="–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        <div id="compactAvatar" class="compact-avatar" aria-hidden="true">
            <div id="compactInitials" class="compact-initials">T</div>
            <img id="compactPhoto" class="compact-photo" style="display: none;" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è">
        </div>
        <div id="compactInfo" class="compact-info">
            <div id="compactName" class="compact-name" aria-live="polite">–ì–æ—Å—Ç—å</div>
            <div id="compactStatus" class="compact-status" aria-live="polite">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
        </div>
        <button id="compactToggle" class="compact-toggle" 
                title="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è"
                aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
                aria-expanded="false">
            <i class="fas fa-chevron-down"></i>
        </button>
        
        <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é -->
        <div id="profileMenu" class="profile-menu" aria-hidden="true">
            <button class="menu-item" onclick="depositBalance()">
                <i class="fas fa-wallet" aria-hidden="true"></i>
                –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
            </button>
            <button class="menu-item" onclick="withdrawBalance()">
                <i class="fas fa-money-bill-transfer" aria-hidden="true"></i>
                –í—ã–≤–µ—Å—Ç–∏
            </button>
            <div class="menu-divider"></div>
            <button class="menu-item logout" onclick="logout()">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                –í—ã–π—Ç–∏
            </button>
        </div>
    </div>

    <!-- Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
    <div id="winnerPush" class="winner-push" role="alert" aria-live="assertive" aria-label="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ">
        <div class="winner-push-content">
            <div class="winner-push-header">
                <span class="winner-push-icon" aria-hidden="true">üèÜ</span>
                <span class="winner-push-title">–ü–û–ë–ï–î–ò–¢–ï–õ–¨ –†–ê–£–ù–î–ê!</span>
                <button class="winner-push-close" 
                        onclick="window.fortuneWheel?.hideWinnerPush()"
                        title="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
                        aria-label="–ó–∞–∫—Ä—ã—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="winner-push-body">
                <div class="winner-push-avatar" aria-hidden="true">
                    <img id="winnerPushPhoto" class="winner-push-photo" style="display: none;" alt="–§–æ—Ç–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è">
                    <div id="winnerPushInitials" class="winner-push-initials">W</div>
                </div>
                <div class="winner-push-details">
                    <div id="winnerPushName" class="winner-push-name" aria-live="polite">–ò–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</div>
                    <div class="winner-push-stats">
                        <span class="winner-push-trophy" aria-label="–ü–æ–±–µ–¥–∏—Ç–µ–ª—å —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞">
                            <i class="fas fa-trophy" aria-hidden="true"></i> –ü–æ–±–µ–¥–∏—Ç–µ–ª—å —ç—Ç–æ–≥–æ —Ä–∞—É–Ω–¥–∞
                        </span>
                    </div>
                    <div class="winner-push-timer">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        –°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑: <span id="winnerPushTimer" aria-live="polite">8</span> —Å–µ–∫
                    </div>
                </div>
            </div>
            <div class="winner-push-footer">
                <button class="winner-push-button" 
                        onclick="window.fortuneWheel?.joinGame()"
                        title="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É"
                        aria-label="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É –∏–≥—Ä—ã">
                    <i class="fas fa-plus" aria-hidden="true"></i> –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ
                </button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="app-container">
        <!-- –í–∫–ª–∞–¥–∫–∞ –ì–ª–∞–≤–Ω–∞—è -->
        <div id="homeTab" class="tab-content active">
            <h1 class="page-title">Stacks</h1>
            
            <!-- –°—Ç–∞—Ç—É—Å -->
            <div id="statusMessage" class="status-message hidden-notification">
                <span id="statusText"></span>
            </div>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ -->
            <div id="authIndicator" class="hidden-notification" style="text-align: center; margin: 10px 0; padding: 10px; background: rgba(0,255,0,0.1); border-radius: 10px;">
                <span style="color: #4ecdc4;">‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫: <span id="currentUserName">–ò–º—è</span></span>
            </div>
            
            
            <!-- –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã -->
            <div class="wheel-container">
            <div class="wheel-wrapper">
                <div id="fortuneWheel" class="wheel">
                    <div id="wheelParticipants"></div>
                </div>
                
                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å —Ç–∞–π–º–µ—Ä–æ–º -->
                <div class="wheel-center">
                    <div class="wheel-timer" id="centerTimer">0</div>
                    <div class="wheel-timer-label">–£–ß–ê–°–¢–ù–ò–ö–û–í</div>
                </div>
                
                <div class="wheel-pointer">‚ñº</div>
            </div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
               <!-- index.html - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–ª–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
                <div class="game-controls">
                    <button id="joinButton" class="game-button"
                            title="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ"
                            aria-label="–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä–µ –Ω–∞ –∫–æ–ª–µ—Å–µ —Ñ–æ—Ä—Ç—É–Ω—ã">
                        <span class="icon" aria-hidden="true">‚ûï</span>
                        –£–ß–ê–°–¢–í–û–í–ê–¢–¨
                    </button>
                    <div style="color: #666; font-size: 0.9rem; text-align: center; margin-top: 10px;">
                        –ò–≥—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è 2-—Ö –∏–≥—Ä–æ–∫–æ–≤
                    </div>
                </div>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
            <div class="participants-list">
                <h3 class="participants-title">
                    <span class="icon">üë•</span>
                    –£–ß–ê–°–¢–ù–ò–ö–ò
                </h3>
                <div id="participantsList"></div>
            </div>
            
            <!-- –í index.html –æ–±–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
            <div id="winnerSection" class="winner-section">
                <h3 class="winner-title">üéâ –ü–û–ë–ï–î–ò–¢–ï–õ–¨ –†–ê–£–ù–î–ê! üéâ</h3>
                <div id="winnerAvatar" class="winner-avatar">
                    <div class="initials">W</div>
                </div>
                <div id="winnerName" class="winner-name">–ò–º—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</div>
                <div style="margin-top: 15px; color: #000; font-size: 1rem;">
                    <div id="nextRoundInfo">–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑: <span id="nextRoundTimer">8</span> —Å–µ–∫</div>
                    <div id="newRoundInfo" style="display: none; margin-top: 10px; font-weight: bold;">
                        üÜï –ù–û–í–´–ô –†–ê–£–ù–î! –ù–∞–∂–º–∏—Ç–µ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profileTab" class="tab-content">
            <h1 class="page-title">üë§ –ü–†–û–§–ò–õ–¨</h1>
            
            <div class="profile-tab">
                <!-- –ë–µ–π–¥–∂ —Ä–µ–∞–ª—å–Ω—ã—Ö/–¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö -->
                <div id="dataBadge" class="status-badge badge-demo">
                    <span id="badgeText">–î–ï–ú–û –†–ï–ñ–ò–ú</span>
                </div>
                
                <!-- –ê–≤–∞—Ç–∞—Ä –∏ –∏–º—è -->
                <div class="profile-header">
                    <div id="profileAvatar" class="profile-avatar">
                        <img id="profilePhoto" class="profile-photo" style="display: none;">
                        <div id="profileInitials" class="initials">T</div>
                    </div>
                    <h2 id="userName" class="profile-name">Telegram User</h2>
                    <div id="userUsername" class="profile-username">@username</div>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div id="profileInfo" class="profile-info-grid">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
                <div style="text-align: center; margin-top: 30px;">
                    <button id="logoutButton" class="game-button" style="background: #ff6b6b;"
                            title="–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞"
                            aria-label="–í—ã–π—Ç–∏ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                        <span class="icon" aria-hidden="true">üö™</span>
                        –í–´–ô–¢–ò
                    </button>
                </div>
            </div>    
        </div>
    </div>
</div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="app-nav" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è" role="tablist">
        <button id="navHome" class="nav-button active" data-tab="homeTab"
                title="–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é"
                role="tab"
                aria-selected="true"
                aria-controls="homeTab">
            <span class="icon" aria-hidden="true">üé∞</span>
            –ì–ª–∞–≤–Ω–∞—è
        </button>
        <button id="navProfile" class="nav-button" data-tab="profileTab"
                title="–ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å"
                role="tab"
                aria-selected="false"
                aria-controls="profileTab">
            <span class="icon" aria-hidden="true">üë§</span>
            –ü—Ä–æ—Ñ–∏–ª—å
        </button>
    </nav>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="/wheel.js"></script>
    <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let tg = null;
    let currentUser = null;
    let isTelegramApp = false;
    
    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const statusMessage = document.getElementById('statusMessage');
    const statusText = document.getElementById('statusText');
    const dataBadge = document.getElementById('dataBadge');
    const badgeText = document.getElementById('badgeText');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
    function initTelegram() {
        if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            tg.expand();
            tg.ready();
            tg.setHeaderColor('#000000');
            tg.setBackgroundColor('#000000');
            isTelegramApp = true;
            
            console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (tg.initData) {
                console.log('üì± –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ Telegram, –ø—ã—Ç–∞–µ–º—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è...');
                autoLogin();
            } else {
                console.log('‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö Telegram, —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞');
                showStatus('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'error');
            }

            function setupJoinButton() {
                const joinButton = document.getElementById('joinButton');
                if (joinButton) {
                    console.log('üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"...');
                    joinButton.addEventListener('click', function() {
                        console.log('üéÆ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"');
                        if (window.fortuneWheel) {
                            window.fortuneWheel.joinGame();
                        } else {
                            console.error('‚ùå –ö–æ–ª–µ—Å–æ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                            showStatus('‚ùå –û—à–∏–±–∫–∞: –∏–≥—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'error');
                        }
                    });
                    console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                } else {
                    console.error('‚ùå –ö–Ω–æ–ø–∫–∞ "joinButton" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }
            }
            
            return true;
        }
        return false;
    }

    console.log('üîß –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM:');
        console.log('  joinButton:', document.getElementById('joinButton') ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω');
        console.log('  fortuneWheel:', document.getElementById('fortuneWheel') ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω');
        console.log('  navHome:', document.getElementById('navHome') ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—ä–µ–∫—Ç –∫–æ–ª–µ—Å–∞
        setTimeout(() => {
            console.log('üé° –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä–µ–∫—Ç–∞ –∫–æ–ª–µ—Å–∞:', window.fortuneWheel ? '‚úÖ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω' : '‚ùå –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            if (window.fortuneWheel) {
                console.log('  –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', window.fortuneWheel.participants.length);
                console.log('  –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', window.currentUser ? window.currentUser.first_name : '–Ω–µ—Ç');
            }
        }, 1000);
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è —Å–Ω–µ–≥–∞ - –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
    document.addEventListener('DOMContentLoaded', function() {
        const snowContainer = document.getElementById('snowContainer');
        
        if (!snowContainer) return;
        
        function createSnowflake() {
            const flake = document.createElement('div');
            flake.className = 'snowflake';
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä
            const size = Math.random() * 5 + 2;
            flake.style.width = `${size}px`;
            flake.style.height = `${size}px`;
            
            // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
            flake.style.left = `${Math.random() * 100}%`;
            
            // –°–ª—É—á–∞–π–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
            flake.style.opacity = Math.random() * 0.7 + 0.3;
            
            // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            const duration = Math.random() * 5 + 5;
            const delay = Math.random() * 5;
            
            flake.style.animation = `
                fall ${duration}s linear ${delay}s infinite,
                sway ${duration/2}s ease-in-out ${delay}s infinite alternate,
                twinkle ${Math.random() * 2 + 1}s ease-in-out ${delay}s infinite alternate
            `;
            
            snowContainer.appendChild(flake);
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                if (flake.parentNode) {
                    flake.remove();
                }
            }, (duration + delay) * 1000);
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º
        function generateSnow() {
            const count = Math.floor(window.innerWidth / 20); // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            for (let i = 0; i < count; i++) {
                setTimeout(() => createSnowflake(), i * 300);
            }
        }
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        generateSnow();
        setInterval(generateSnow, 10000); // –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        
        // –†–µ—Å–ø–∞–≤–Ω –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                snowContainer.innerHTML = '';
                generateSnow();
            }, 250);
        });
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function updateAuthIndicator() {
        const authIndicator = document.getElementById('authIndicator');
        const currentUserName = document.getElementById('currentUserName');
        
        if (window.currentUser) {
            authIndicator.style.display = 'block';
            currentUserName.textContent = window.currentUser.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            console.log(`üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: ${window.currentUser.first_name}`);
        } else {
            authIndicator.style.display = 'none';
            console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        }
    }

    // –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –≤ wheel.js –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ index.html
    function updateWheelTimer(seconds, participantsCount) {
        const centerTimer = document.getElementById('centerTimer');
        const timerLabel = document.querySelector('.wheel-timer-label');
        
        if (centerTimer) {
            centerTimer.textContent = seconds;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
            centerTimer.classList.remove('pulse');
            void centerTimer.offsetWidth; // –¢—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
            centerTimer.classList.add('pulse');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –ø–æ–¥ —Ç–∞–π–º–µ—Ä–æ–º —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            if (timerLabel) {
                timerLabel.textContent = `–£–ß–ê–°–¢–ù–ò–ö–û–í: ${participantsCount || 0}`;
            }
            
            // –¶–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏
            if (seconds <= 5) {
                centerTimer.style.color = '#ff6b6b'; // –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–µ–∫—É–Ω–¥
            } else if (seconds <= 10) {
                centerTimer.style.color = '#ffa726'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π
            } else {
                centerTimer.style.color = '#4ecdc4'; // –ó–µ–ª–µ–Ω—ã–π/–±–∏—Ä—é–∑–æ–≤—ã–π
            }
        }
    }

    // –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∞–π–º–µ—Ä–µ –Ω–∞ –∫–æ–ª–µ—Å–µ
    function updateTimerDisplay(gameState) {
        if (!gameState) return;
        
        const timeRemaining = Math.max(0, Math.floor((gameState.gameEndsAt - Date.now()) / 1000));
        const participantsCount = gameState.participants ? gameState.participants.length : 0;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ–ª–µ—Å–∞
        updateWheelTimer(timeRemaining, participantsCount);
        
        // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –¥—Ä—É–≥–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        const gameTimer = document.getElementById('gameTimer');
        if (gameTimer) {
            gameTimer.textContent = timeRemaining;
        }
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
    // –í index.html –¥–æ–±–∞–≤—å—Ç–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é autoLogin():
    async function autoLogin() {
        try {
            // showStatus('‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...', 'info');
            
            const response = await fetch('/api/auth', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ initData: tg.initData })
            });
            
            const data = await response.json();
            
            if (data.success && data.user) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
                window.currentUser = data.user;
                currentUser = data.user;
                
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:', window.currentUser.first_name);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                updateAuthIndicator();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–µ—Å–æ –µ—Å–ª–∏ –æ–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
                if (window.fortuneWheel) {
                    window.fortuneWheel.updateButtons();
                    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–∏
                    setTimeout(() => {
                        window.fortuneWheel.loadGameState();
                    }, 500);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                updateProfileTab();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂
                if (dataBadge) {
                    dataBadge.className = 'status-badge badge-real';
                    badgeText.textContent = '–†–ï–ê–õ–¨–ù–´–ô –†–ï–ñ–ò–ú';
                }
                
                // showStatus(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${data.user.first_name}!`, 'success');
                
                // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                window.dispatchEvent(new CustomEvent('userChanged'));
                
                console.log(`‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: ${data.user.first_name} (ID: ${data.user.id})`);
            } else {
                showStatus('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + (data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', data.error);
            }
        } catch (error) {
            console.error('Auto login error:', error);
            showStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
        }
    }
    
    // –ó–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é showStatus
    function showStatus(message, type = 'info') {
        if (!statusText || !statusMessage) return;
        
        statusText.textContent = message;
        statusMessage.className = `status-message status-${type} hidden-notification visible`;
        
        // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å console.log, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–≤–∏–¥–∏—Ç
        if (type === 'error') {
            console.error(`üì¢ –û—à–∏–±–∫–∞: ${message}`);
        } else {
            console.log(`üì¢ –°—Ç–∞—Ç—É—Å (${type}): ${message}`);
        }
        
        // –ê–≤—Ç–æ—Å–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ-–æ—à–∏–±–æ–∫
        if (type !== 'error') {
            setTimeout(() => {
                statusMessage.classList.remove('visible');
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥ —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å —Å—Ç–∞—Ç—É—Å–∞
                setTimeout(() => {
                    statusMessage.className = 'status-message hidden-notification';
                }, 500);
            }, 3000);
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        window.showStatus = showStatus;
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫—É –ø—Ä–æ—Ñ–∏–ª—è
    // –û–±–Ω–æ–≤–∏—Ç—å –≤–∫–ª–∞–¥–∫—É –ø—Ä–æ—Ñ–∏–ª—è
    function updateProfileTab() {
        const user = window.currentUser || currentUser;
        
        if (!user) {
            console.log('‚ùå –ù–µ –º–æ–≥—É –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
            return;
        }
        
        console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user.first_name);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ–∏–ª—è
        const profileAvatar = document.getElementById('profileAvatar');
        const profileInitials = document.getElementById('profileInitials');
        const profilePhoto = document.getElementById('profilePhoto');
        const userName = document.getElementById('userName');
        const userUsername = document.getElementById('userUsername');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Ç–æ–∂–µ
        updateCompactProfile();
        
        if (!profileAvatar || !userName || !profileInfo) {
            console.log('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è');
            return;
        }
        
        // –ê–≤–∞—Ç–∞—Ä - –û–ß–ï–ù–¨ –í–ê–ñ–ù–û: –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ photo_url
        if (user.photo_url && user.photo_url.trim() !== '') {
            console.log('üì∏ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è:', user.photo_url);
            
            if (profilePhoto) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º src —Å –∫–æ–ª–±—ç–∫–æ–º –Ω–∞ –æ—à–∏–±–∫—É –∑–∞–≥—Ä—É–∑–∫–∏
                profilePhoto.src = user.photo_url;
                profilePhoto.style.display = 'block';
                
                profilePhoto.onload = function() {
                    console.log('‚úÖ –§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                    if (profileInitials) profileInitials.style.display = 'none';
                };
                
                profilePhoto.onerror = function() {
                    console.log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã');
                    profilePhoto.style.display = 'none';
                    if (profileInitials) {
                        const initials = getInitials(user.first_name, user.last_name);
                        profileInitials.textContent = initials;
                        profileInitials.style.display = 'flex'; // –ò–∑–º–µ–Ω–µ–Ω–æ —Å block –Ω–∞ flex
                    }
                };
            }
        } else {
            console.log('üì∏ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã');
            if (profilePhoto) {
                profilePhoto.style.display = 'none';
            }
            if (profileInitials) {
                const initials = getInitials(user.first_name, user.last_name);
                profileInitials.textContent = initials;
                profileInitials.style.display = 'flex'; // –ò–∑–º–µ–Ω–µ–Ω–æ —Å block –Ω–∞ flex
            }
        }
        
        // –ò–º—è –∏ username
        userName.textContent = `${user.first_name || ''} ${user.last_name || ''}`.trim();
        if (userUsername) {
            userUsername.textContent = user.username ? `@${user.username}` : '–ë–µ–∑ username';
        }
        
        // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        profileInfo.innerHTML = '';
        
        const infoCards = [
            { label: 'ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', value: user.id, icon: 'üÜî' },
            { label: '–ò–º—è', value: user.first_name || '‚Äî', icon: 'üë§' },
            { label: '–§–∞–º–∏–ª–∏—è', value: user.last_name || '‚Äî', icon: 'üë•' },
            { label: 'Username', value: user.username ? '@' + user.username : '‚Äî', icon: 'üìõ' },
            { label: '–Ø–∑—ã–∫', value: user.language_code?.toUpperCase() || 'RU', icon: 'üåê' },
            { label: 'Premium —Å—Ç–∞—Ç—É—Å', value: user.is_premium ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ùå –ù–µ –∞–∫—Ç–∏–≤–µ–Ω', icon: '‚≠ê' },
            { label: '–î–æ—Å—Ç—É–ø –∫ –õ–°', value: user.allows_write_to_pm ? '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω' : '‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω', icon: 'üí¨' },
            { label: '–î–∞—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', value: new Date().toLocaleDateString('ru-RU'), icon: 'üìÖ' },
            { label: '–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö', value: user.is_demo ? '–î–µ–º–æ —Ä–µ–∂–∏–º' : '–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', icon: 'üîê' },
            { label: '–°—Ç–∞—Ç—É—Å', value: '–û–Ω–ª–∞–π–Ω', icon: 'üíö' }
        ];
        
        if (user.photo_url) {
            infoCards.unshift({ 
                label: '–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è', 
                value: user.photo_url ? '‚úÖ –ï—Å—Ç—å' : '‚ùå –ù–µ—Ç', 
                icon: 'üì∏' 
            });
        }
        
        infoCards.forEach(card => {
            const cardElement = document.createElement('div');
            cardElement.className = 'info-card';
            cardElement.innerHTML = `
                <div class="info-label">
                    <span class="icon">${card.icon}</span>
                    ${card.label}
                </div>
                <div class="info-value">${card.value}</div>
            `;
            profileInfo.appendChild(cardElement);
        });
        
        console.log('‚úÖ –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
    }
    
    function getInitials(firstName, lastName) {
        if (!firstName && !lastName) return '??';
        const first = firstName ? firstName.charAt(0).toUpperCase() : '';
        const last = lastName ? lastName.charAt(0).toUpperCase() : '';
        return (first + last) || 'U';
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    function setupNavigation() {
        const navButtons = document.querySelectorAll('.nav-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                navButtons.forEach(btn => {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-selected', 'false');
                });
                
                tabContents.forEach(tab => tab.classList.remove('active'));
                
                button.classList.add('active');
                button.setAttribute('aria-selected', 'true');
                document.getElementById(tabId).classList.add('active');
                
                console.log(`üì± –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –≤–∫–ª–∞–¥–∫—É: ${tabId}`);
                
                // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
                if (tabId === 'profileTab' && currentUser) {
                    setTimeout(updateProfileTab, 100);
                }
            });
        });
    }
    
    // –í—ã–π—Ç–∏
    function logout() {
        console.log('üö™ –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞...');
        
        currentUser = null;
        window.currentUser = null;
        
        if (dataBadge) {
            dataBadge.className = 'status-badge badge-demo';
            badgeText.textContent = '–î–ï–ú–û –†–ï–ñ–ò–ú';
        }
        
        updateProfileTab();
        updateAuthIndicator();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–µ—Å–æ
        if (window.fortuneWheel) {
            window.fortuneWheel.updateButtons();
            window.fortuneWheel.loadGameState();
        }
        
        showStatus('‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'success');
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
        const homeButton = document.getElementById('navHome');
        if (homeButton) homeButton.click();
        
        // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.dispatchEvent(new CustomEvent('userChanged'));
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', () => {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
        
        initTelegram();
        setupNavigation();
        setupJoinButton();
        
        
    });

    // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–Ω–µ—Ü —Å–∫—Ä–∏–ø—Ç–∞ –≤ index.html:

// –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
function updateCompactProfile() {
    const user = window.currentUser || currentUser;
    const compactProfile = document.getElementById('compactProfile');
    const compactAvatar = document.getElementById('compactAvatar');
    const compactPhoto = document.getElementById('compactPhoto');
    const compactInitials = document.getElementById('compactInitials');
    const compactName = document.getElementById('compactName');
    const compactStatus = document.getElementById('compactStatus');
    
    if (!compactProfile || !compactName) return;
    
    if (user) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
        if (user.photo_url) {
            compactPhoto.src = user.photo_url;
            compactPhoto.style.display = 'block';
            compactInitials.style.display = 'none';
        } else {
            const initials = getInitials(user.first_name, user.last_name);
            compactInitials.textContent = initials;
            compactInitials.style.display = 'flex';
            compactPhoto.style.display = 'none';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –∏ —Å—Ç–∞—Ç—É—Å
        compactName.textContent = `${user.first_name} ${user.last_name || ''}`.trim();
        compactStatus.textContent = user.username ? `@${user.username}` : '–í —Å–µ—Ç–∏';
        compactStatus.style.color = '#ffffff';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
        compactProfile.style.display = 'flex';
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º
        compactInitials.textContent = '?';
        compactInitials.style.display = 'flex';
        compactPhoto.style.display = 'none';
        compactName.textContent = '–ì–æ—Å—Ç—å';
        compactStatus.textContent = '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
        compactStatus.style.color = '#ffffff';
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è
function setupCompactProfileToggle() {
    const compactToggle = document.getElementById('compactToggle');
    const profileMenu = document.getElementById('profileMenu');
    const compactProfile = document.getElementById('compactProfile');
    
    console.log('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è...');
    console.log('  compactToggle:', compactToggle ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω');
    console.log('  profileMenu:', profileMenu ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω');
    console.log('  compactProfile:', compactProfile ? '‚úÖ –Ω–∞–π–¥–µ–Ω' : '‚ùå –Ω–µ –Ω–∞–π–¥–µ–Ω');
    
    if (compactToggle && profileMenu) {
        let isMenuOpen = false;
        
        function toggleMenu() {
            console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–Ω—é, —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:', isMenuOpen);
            isMenuOpen = !isMenuOpen;
            
            if (isMenuOpen) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                profileMenu.classList.add('show');
                profileMenu.setAttribute('aria-hidden', 'false');
                compactToggle.setAttribute('aria-expanded', 'true');
                compactToggle.innerHTML = '<i class="fas fa-chevron-up" aria-hidden="true"></i>';
                compactToggle.setAttribute('title', '–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è');
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
                document.addEventListener('keydown', handleEscapeKey);
            } else {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
                profileMenu.classList.remove('show');
                profileMenu.setAttribute('aria-hidden', 'true');
                compactToggle.setAttribute('aria-expanded', 'false');
                compactToggle.innerHTML = '<i class="fas fa-chevron-down" aria-hidden="true"></i>';
                compactToggle.setAttribute('title', '–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è');
                
                document.removeEventListener('keydown', handleEscapeKey);
            }
        }
        
        function handleEscapeKey(event) {
            if (event.key === 'Escape' && isMenuOpen) {
                toggleMenu();
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É
        compactToggle.addEventListener('click', function(event) {
            event.stopPropagation();
            toggleMenu();
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(event) {
            if (isMenuOpen && 
                !compactProfile.contains(event.target) && 
                !profileMenu.contains(event.target)) {
                toggleMenu();
            }
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        window.addEventListener('userChanged', function() {
            if (isMenuOpen) {
                toggleMenu();
            }
        });
        
        console.log('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–Ω—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
    } else {
        console.error('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–Ω—é');
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–µ–Ω—é (–∑–∞–≥–ª—É—à–∫–∏ - –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É)
function depositBalance() {
    console.log('üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞');
    showStatus('–§—É–Ω–∫—Ü–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ', 'info');
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
}

function withdrawBalance() {
    console.log('üí∏ –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤');
    showStatus('–§—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–∑–∂–µ', 'info');
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç API –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—ã–≤–æ–¥–∞
}

// –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è logout —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// –ï—Å–ª–∏ –Ω–µ—Ç, –¥–æ–±–∞–≤—å—Ç–µ:
function logout() {
    console.log('üö™ –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞...');
    
    // –í–∞—à–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞
    currentUser = null;
    window.currentUser = null;
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ ...
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
    const profileMenu = document.getElementById('profileMenu');
    if (profileMenu) {
        profileMenu.classList.remove('show');
    }
    
    showStatus('‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'success');
}

document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
    
    initTelegram();
    setupNavigation();
    setupJoinButton();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–∑–æ–≤—ã
    updateCompactProfile();
    setupCompactProfileToggle(); // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    
    window.addEventListener('userChanged', () => {
        updateCompactProfile();
    });
    
    
    if (!isTelegramApp) {
        console.log('‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω–µ Telegram');
        showStatus('‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', 'error');
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—ã—Ö–æ–¥–∞
    const logoutButton = document.getElementById('logoutButton');
    if (logoutButton) {
        logoutButton.addEventListener('click', logout);
    }
    
    // –î–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
    window.currentUser = currentUser;
    window.showStatus = showStatus;
    window.updateProfileTab = updateProfileTab;
    window.getInitials = getInitials;
    
    console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞
    const centerTimer = document.getElementById('centerTimer');
    if (centerTimer) {
        centerTimer.textContent = '0';
    }
    
    // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FortuneWheel –∫–ª–∞—Å—Å, –¥–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ –º–µ—Ç–æ–¥
    if (window.fortuneWheel) {
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        const originalUpdateTimer = window.fortuneWheel.updateTimer;
        window.fortuneWheel.updateTimer = function(gameState) {
            if (originalUpdateTimer) {
                originalUpdateTimer.call(this, gameState);
            }
            updateTimerDisplay(gameState);
        };
    }
});
</script>
</body>
</html>